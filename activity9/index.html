<html>
  <head>
    <title>My Blog</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <style>
      table {
        width: 100%;
      }
      table,
      th,
      td {
        border: 1px solid black;
        border-collapse: collapse;
        padding: 10px;
      }
      .center {
        display: block;
        margin-left: auto;
        margin-right: auto;
        width: auto;
      }
    </style>
  </head>
  <body>
    <h1 align="center">Mensagem:</h1>
    <hr />
    <br />
    <form>
      <label>Mensagem:</label>
      <input type="text" size="64" name="msg" id="msg" /><br /><br />
      <label>Autor:</label>
      <input type="text" size="64" name="autor" id="autor" />
      <br /><br />
      <button type="button" onclick="send()">Enviar</button>
      <button type="button" onclick="getMessages()">Carregar</button>
    </form>
    <hr />
    <br />

    <table id="messagesTable" align="center">
      <tr>
        <th>Message</th>
        <th>Author</th>
        <th>Date</th>
      </tr>
    </table>
    <script type="application/javascript">
      function send(event) {
        var message = document.getElementById("msg");
        var author = document.getElementById("autor");
        data = {
          message: message.value,
          author: author.value,
        };
        var json_data = JSON.stringify(data);

        var header = {
          "Cotent-Type": "application/json",
        };

        var url =
          "https://script.google.com/macros/s/AKfycbzBn3sALe1rYjz7Ze-Ik7q9TEVP0I2V3XX7GNcecWP8NvCzGt4yO_RT1OlQp09TE9cU/exec";

        fetch(url, {
          method: "POST",
          body: json_data,
          headers: header,
          mode: "no-cors",
        });

        getMessages();
        message.value = "";
        author.value = "";
      }

      function getMessages() {
        var loading = document.getElementById("loading");

        var table = document.getElementById("messagesTable");
        var url =
          "https://script.google.com/macros/s/AKfycbzBn3sALe1rYjz7Ze-Ik7q9TEVP0I2V3XX7GNcecWP8NvCzGt4yO_RT1OlQp09TE9cU/exec";
        var ajax = new XMLHttpRequest();

        var qtt = table.rows.length - 1;
        console.log(qtt);

        ajax.open("GET", `${url}?tenho=${qtt}`, true);
        ajax.onload = function () {
          if (ajax.status === 200) {
            var jsonObj = JSON.parse(ajax.responseText);
            var position = 1;

            jsonObj.forEach((message) => {
              var row = table.insertRow(position);

              var messageCell = row.insertCell(0);
              var authorCell = row.insertCell(1);
              var dateCell = row.insertCell(2);

              messageCell.innerHTML = message[0];
              authorCell.innerHTML = message[1];
              dateCell.innerHTML = message[2];

              position += 1;
            });
            loading.innerHTML = "";
          }
        };
        ajax.send();
      }

      getMessages();
    </script>
  </body>
</html>
